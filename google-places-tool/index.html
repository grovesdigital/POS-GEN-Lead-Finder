<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>POS-Gen Lead Finder - Google Places Query Tool</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Setup Screen (First Time) -->
    <div id="setupScreen" class="setup-screen" style="display: none;">
        <div class="setup-container">
            <div class="setup-content">
                <div class="setup-icon">üéØ</div>
                <div class="setup-brand">
                    <h1>POS-Gen Lead Finder</h1>
                    <span class="setup-badge">PRO</span>
                </div>
                <p class="setup-subtitle">Discover, analyze, and generate leads with intelligent location search</p>

                <div class="setup-card">
                    <h2>Setup Your API Key</h2>
                    <p>To get started, you'll need a Google Places API (New) key.</p>

                    <div class="setup-steps">
                        <div class="step">
                            <div class="step-number">1</div>
                            <div class="step-content">
                                <h3>Get Your API Key</h3>
                                <p>Visit <a href="https://console.cloud.google.com/" target="_blank">Google Cloud Console</a></p>
                            </div>
                        </div>
                        <div class="step">
                            <div class="step-number">2</div>
                            <div class="step-content">
                                <h3>Enable Required APIs</h3>
                                <p>Places API (New), Maps JavaScript API, Places Autocomplete</p>
                            </div>
                        </div>
                        <div class="step">
                            <div class="step-number">3</div>
                            <div class="step-content">
                                <h3>Enter Your Key Below</h3>
                                <p>It will be securely stored in your browser</p>
                            </div>
                        </div>
                    </div>

                    <form id="setupForm">
                        <div class="form-group">
                            <label for="setupApiKey">Google API Key</label>
                            <input
                                type="text"
                                id="setupApiKey"
                                placeholder="Enter your Google Places API key"
                                required
                            >
                            <small>Your API key is encrypted and stored locally in your browser</small>
                        </div>

                        <div id="setupError" class="error-message" style="display: none;"></div>

                        <button type="submit" class="btn btn-primary btn-large">
                            Continue to Search Tool
                        </button>
                    </form>
                </div>

                <div class="setup-footer">
                    <p><strong>POS-Gen Lead Finder</strong> ‚Ä¢ Complies with Google Maps Platform TOS</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" class="main-app" style="display: none;">
        <!-- Header -->
        <header class="app-header">
                <div class="header-content">
                    <div class="header-left">
                        <div class="brand-logo">
                            <span class="brand-icon">üéØ</span>
                            <div class="brand-text">
                                <span class="brand-name">POS-Gen</span>
                                <span class="brand-tagline">Lead Finder</span>
                            </div>
                        </div>
                        <div class="header-meta">
                            <span class="header-badge">PRO</span>
                            <span class="header-description">Powered by Google Places API ‚Ä¢ Find &amp; Generate Leads</span>
                        </div>
                    </div>
                    <div class="header-right">
                        <button id="settingsBtn" class="btn btn-icon" title="Settings">
                            ‚öôÔ∏è
                        </button>
                </div>
            </div>
        </header>

        <!-- Branding Bar -->
        <div class="branding-bar">
            <div class="branding-content">
                <div class="view-toggle-bar">
                    <button id="quickSearchViewBtn" class="btn-view-toggle active">
                        üîç Quick Search
                    </button>
                    <button id="campaignBuilderViewBtn" class="btn-view-toggle">
                        üéØ Campaign Builder
                    </button>
                </div>
                <div class="branding-stats">
                    <div class="stat-item">
                        <span class="stat-icon">üó∫Ô∏è</span>
                        <span class="stat-label">Search</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-icon">üìä</span>
                        <span class="stat-label">Analyze</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-icon">‚ú®</span>
                        <span class="stat-label">Generate</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="app-content">
            <!-- Quick Search View (Original) -->
            <div id="quickSearchView" class="view-container">
                <!-- Full Screen Map -->
                <div id="map" class="map-container-fullscreen"></div>
                <div id="mapPlaceholder" class="map-placeholder-fullscreen">
                    <div class="placeholder-content">
                        <div class="placeholder-icon">üó∫Ô∏è</div>
                        <h3>Search for Places</h3>
                        <p>Enter a location and select business types to preview results on the map</p>
                    </div>
                </div>

                <!-- Floating Search Panel -->
                <div class="floating-search-panel">
                <div class="panel-header-floating">
                    <h2>üîç Search Parameters</h2>
                    <div class="panel-header-right">
                        <span id="resultsCount" class="results-badge-header">0 results</span>
                        <button id="togglePanelBtn" class="btn-toggle-panel" title="Toggle panel">
                            <span id="toggleIcon">‚óÄ</span>
                        </button>
                    </div>
                </div>

                <div class="panel-body-floating">
                    <form id="searchForm">
                        <!-- Location Search -->
                        <div class="form-group">
                            <label for="locationSearch">
                                <span class="label-icon">üìç</span>
                                Search Location
                            </label>
                            <input
                                type="text"
                                id="locationSearch"
                                placeholder="Enter city, address, or place name..."
                                autocomplete="off"
                            >
                            <small id="selectedLocation" class="location-info"></small>
                        </div>

                        <!-- Radius Slider -->
                        <div class="form-group hidden-until-location" id="radiusGroup">
                            <label for="radiusSlider">
                                <span class="label-icon">üìè</span>
                                Search Radius: <span id="radiusValue">1km</span>
                            </label>
                            <input
                                type="range"
                                id="radiusSlider"
                                min="0"
                                max="8"
                                step="1"
                                value="4"
                                class="slider"
                            >
                            <div class="slider-labels">
                                <span>100m</span>
                                <span>5km</span>
                            </div>
                        </div>

                        <!-- Business Types (Checkbox List) -->
                        <div class="form-group hidden-until-location" id="businessTypesGroup">
                            <label>
                                <span class="label-icon">üè¢</span>
                                Business Types
                            </label>
                            <small>Select one or more business types to search</small>

                            <div class="business-types-list" id="businessTypesList">
                                <!-- Options will be populated by JS -->
                            </div>

                            <button type="button" id="showMoreTypesBtn" class="btn-show-more">
                                <span id="showMoreText">Show All Types</span>
                                <span id="showMoreIcon">‚ñº</span>
                            </button>

                            <div id="selectedTypesCount" class="selected-count"></div>
                        </div>
                    </form>

                    <div id="searchError" class="error-message" style="display: none;"></div>
                    <div id="searchStatus" class="info-message" style="display: none;"></div>
                </div>

                <!-- Action Buttons Footer -->
                <div class="floating-panel-footer">
                    <button type="button" id="updateMapBtn" class="btn btn-primary btn-footer">
                        üîç Find businesses
                    </button>
                    <button type="button" id="viewResultsBtn" class="btn btn-secondary btn-footer" disabled>
                        üìã View Results
                    </button>
                </div>
            </div>
            </div>
            <!-- End Quick Search View -->

            <!-- Campaign Builder View -->
            <div id="campaignBuilderView" class="view-container campaign-builder-view" style="display: none;">
                <div id="campaignBuilderIntro" class="campaign-builder-intro">
                    <h2>Welcome to the Campaign Builder</h2>
                    <p>
                        Use the Campaign Builder to batch-create campaign-ready assets across a diverse mix of services, keeping every outreach fresh and relevant.
                    </p>
                    <p>
                        Select the businesses you want to target, we generate tailored assets, and you can approve them, send any that need polishing into the editor, or reject them altogether. Once everything looks good, we prepare personalized outreach emails that weave in your campaign background, each asset, and a booking link so you can finalize payments and next steps before sending.
                    </p>
                </div>

                <div class="campaign-steps-container">
                    <!-- Step 1: Campaign Setup -->
                    <div class="campaign-step" data-step="1">
                        <div class="step-header" data-step="1">
                            <span class="step-number">1</span>
                            <div class="step-header-text">
                                <h2>Campaign Setup</h2>
                                <p class="step-subtitle">Define your advertising location and campaign details, then select nearby businesses to include.</p>
                            </div>
                            <button class="step-toggle" data-step="1" aria-label="Toggle step">‚àí</button>
                        </div>
                        <div class="step-content" data-step="1">
                            <form id="campaignForm">
                                <div class="campaign-setup-section" id="campaignCoreFields" style="display: none;">
                                    <!-- Campaign Name & Theme Row -->
                                    <div class="form-grid form-grid-two">
                                        <div class="form-group">
                                            <label for="campaignName">Campaign Name</label>
                                            <input
                                                type="text"
                                                id="campaignName"
                                                placeholder="e.g., Christmas 2025 Campaign"
                                                required
                                            >
                                            <small>Use a clear internal name for this campaign</small>
                                        </div>

                                        <div class="form-group">
                                            <label for="campaignTheme">Campaign Theme</label>
                                            <input
                                                type="text"
                                                id="campaignTheme"
                                                placeholder="e.g., Christmas, Valentine's Day, Summer Sale"
                                            >
                                            <small>This will influence the messaging tone</small>
                                        </div>
                                    </div>

                                    <!-- Campaign Description -->
                                    <div class="form-group">
                                        <label for="campaignDescription">Campaign Description</label>
                                        <textarea
                                            id="campaignDescription"
                                            rows="3"
                                            placeholder="Brief description of campaign goals and target audience..."
                                        ></textarea>
                                        <small>Highlight the key message and who you want to reach</small>
                                    </div>
                                </div>

                                <!-- Store Location, Distance & Businesses Per Industry Row -->
                                <div class="form-grid form-grid-three">
                                    <div class="form-group">
                                        <label for="campaignLocationSearch">Advertising Location</label>
                                        <input
                                            type="text"
                                            id="campaignLocationSearch"
                                            placeholder="Enter the advertising venue or location..."
                                            autocomplete="off"
                                        >
                                        <small class="form-help">The location where the ad will be shown</small>
                                        <small id="campaignSelectedLocation" class="location-info"></small>
                                    </div>

                                    <div class="form-group" id="campaignRadiusGroup" style="display: none;">
                                        <label for="campaignRadiusSlider">Max Distance: <span id="campaignRadiusValue">5km</span></label>
                                        <input
                                            type="range"
                                            id="campaignRadiusSlider"
                                            min="0"
                                            max="8"
                                            step="1"
                                            value="8"
                                            class="slider"
                                        >
                                        <div class="slider-labels">
                                            <span>100m</span>
                                            <span>5km</span>
                                        </div>
                                        <small>Search for businesses within this radius</small>
                                    </div>

                                    <div class="form-group" id="campaignBusinessesPerTypeGroup" style="display: none;">
                                        <label for="campaignBusinessesPerType">Businesses Per Industry</label>
                                        <input
                                            type="number"
                                            id="campaignBusinessesPerType"
                                            min="1"
                                            max="20"
                                            value="3"
                                        >
                                        <small>Number of top businesses to suggest per industry (max 20)</small>
                                    </div>
                                </div>

                                <!-- Business Types Selection -->
                                <div class="form-group" id="campaignBusinessTypesGroup" style="display: none;">
                                    <div class="form-group-header">
                                        <label>Target Business Types</label>
                                        <span id="campaignSelectedTypesCount" class="selection-counter selection-counter--types">0 types selected</span>
                                    </div>
                                    <small id="campaignBusinessTypesHint">Select industries to target</small>

                                    <div class="campaign-business-types-sections">
                                        <div class="business-types-section">
                                            <div class="business-types-section-header">
                                                <span class="business-types-section-title">Recommended Types</span>
                                            </div>
                                            <div class="campaign-business-types" id="campaignBusinessTypesRecommended">
                                                <!-- Recommended checkboxes -->
                                            </div>
                                        </div>
                                        <div class="business-types-section advanced collapsed" id="campaignBusinessTypesAdvancedSection">
                                            <div class="business-types-section-header">
                                                <span class="business-types-section-title">Advanced Types</span>
                                                <button type="button" id="toggleAdvancedTypesBtn" class="btn-toggle-advanced">
                                                    Show Advanced Types
                                                </button>
                                            </div>
                                            <div class="campaign-business-types" id="campaignBusinessTypesAdvanced">
                                                <!-- Advanced checkboxes -->
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Search Button -->
                                <div class="form-group" style="display: none;" id="campaignSearchBtnGroup">
                                    <button type="button" id="campaignSearchBtn" class="btn btn-primary btn-block">
                                        Find Top Businesses
                                    </button>
                                </div>
                            </form>

                            <div id="campaignSearchError" class="error-message" style="display: none;"></div>
                            <div id="campaignSearchStatus" class="info-message" style="display: none;"></div>
                        </div>
                    </div>

                    <!-- Step 2: Business Suggestions -->
                    <div class="campaign-step" data-step="2" style="display: none;">
                        <div class="step-header" data-step="2">
                            <span class="step-number">2</span>
                            <div class="step-header-text">
                                <h2>Business Suggestions</h2>
                                <p class="step-subtitle" id="campaignResultsSubtitle">Select businesses per industry</p>
                            </div>
                            <button class="step-toggle" data-step="2" aria-label="Toggle step">‚àí</button>
                        </div>
                        <div class="step-content" data-step="2">
                            <div class="step-actions-header">
                                <button class="btn-select-all-groups" id="selectAllGroupsBtn" style="display: none;">
                                    ‚úì Select All Groups
                                </button>
                            </div>

                            <div id="campaignResultsContainer" class="campaign-results-container">
                                <div class="empty-state">
                                    <div class="empty-state-icon">üéØ</div>
                                    <h3>No Results Yet</h3>
                                    <p>Configure your campaign and click "Find Top Businesses" to see suggestions</p>
                                </div>
                            </div>

                            <div class="step-footer-actions" id="step2FooterActions" style="display: none;">
                                <button type="button" id="confirmBusinessesBtn" class="btn btn-primary btn-block">
                                    Confirm Businesses
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Step 3: Campaign Actions -->
                    <div class="campaign-step" data-step="3" style="display: none;">
                        <div class="step-header" data-step="3">
                            <span class="step-number">3</span>
                            <div class="step-header-text">
                                <h2>Campaign Actions</h2>
                                <p class="step-subtitle">Use your selected businesses to launch assets and outreach.</p>
                            </div>
                            <button class="step-toggle" data-step="3" aria-label="Toggle step">‚àí</button>
                        </div>
                        <div class="step-content" data-step="3">
                            <div class="campaign-actions-summary">
                                <div class="summary-header">
                                    <h3>Selected Businesses</h3>
                                    <span id="selectedBusinessesCount" class="selected-badge">0</span>
                                </div>
                                <div id="campaignSelectionSummary" class="selection-summary">
                                    Select businesses in the suggestions panel to get started.
                                </div>
                            </div>

                            <!-- Campaign Actions -->
                            <div class="campaign-actions">
                                <button type="button" id="generateAssetsBtn" class="btn btn-primary btn-block" disabled>
                                    Create Assets for 0 Businesses
                                </button>
                                <button type="button" id="createEmailTemplateBtn" class="btn btn-secondary btn-block" disabled title="Communication templates coming soon">
                                    Create Communication Template
                                </button>
                            </div>
                            <div id="campaignAssetsStatus" class="info-message" style="display: none; margin-top: 1rem;"></div>
                            <div id="campaignAssetsError" class="error-message" style="display: none; margin-top: 1rem;"></div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- End Campaign Builder View -->
        </div>
    </div>

    <!-- Results Page -->
    <div id="resultsPage" class="results-page" style="display: none;">
        <header class="app-header">
            <div class="header-content">
                <div class="header-left">
                    <div class="brand-logo">
                        <span class="brand-icon">üéØ</span>
                        <div class="brand-text">
                            <span class="brand-name">POS-Gen</span>
                            <span class="brand-tagline">Lead Finder</span>
                        </div>
                    </div>
                    <div class="header-meta">
                        <span class="header-badge">PRO</span>
                        <span class="header-description">Powered by Google Places API ‚Ä¢ Find &amp; Generate Leads</span>
                    </div>
                </div>
                <div class="header-right">
                    <button id="backToSearchBtn" class="btn btn-secondary">‚Üê Back</button>
                    <button id="exportJsonBtn" class="btn btn-primary">Export JSON</button>
                    <button id="exportCsvBtn" class="btn btn-primary">Export CSV</button>
                </div>
            </div>
        </header>

        <!-- Branding Bar for Results -->
        <div class="branding-bar branding-bar-results">
            <div class="branding-content">
                <span class="branding-description">Lead Results ‚Ä¢ Sort, Filter & Generate Ads</span>
            </div>
        </div>

        <div class="results-content">
            <div class="results-header">
                <h2>Search Results</h2>
                <p id="resultsInfo"></p>
            </div>

            <div class="results-controls">
                <div class="sort-section">
                    <label for="sortSelect">
                        <span class="sort-icon">‚áÖ</span>
                        Sort by:
                    </label>
                    <select id="sortSelect" class="sort-dropdown">
                        <option value="distance">Distance (Closest First)</option>
                        <option value="rating">Rating (Highest First)</option>
                        <option value="reviewCount">Review Count (Most First)</option>
                        <option value="name">Name (A-Z)</option>
                        <option value="status">Status (Operational First)</option>
                    </select>
                </div>
                <div class="filter-section">
                    <label class="filter-checkbox">
                        <input type="checkbox" id="filterOpenNow">
                        <span>Open Now Only</span>
                    </label>
                    <label class="filter-checkbox">
                        <input type="checkbox" id="filterMinRating">
                        <span>Min Rating 4.0+</span>
                    </label>
                </div>
            </div>

            <div id="resultsGrid" class="results-grid">
                <!-- Result cards will be populated here -->
            </div>

            <div id="noResults" class="no-results" style="display: none;">
                <div class="no-results-icon">üîç</div>
                <h3>No Results Found</h3>
                <p>Try adjusting your search parameters or increasing the radius</p>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal" style="display: none;">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2>Settings</h2>
                <button class="modal-close" id="closeSettingsBtn">√ó</button>
            </div>
            <div class="modal-body">
                <form id="settingsForm">

                    <div class="form-group">
                        <label for="settingsApiKey">Google API Key</label>
                        <input
                            type="text"
                            id="settingsApiKey"
                            placeholder="Enter new API key"
                        >
                        <small>Leave blank to keep current key</small>
                    </div>

                    <div class="form-group">
                        <label for="settingsLLMApiKey">LLM API Key</label>
                        <input
                            type="text"
                            id="settingsLLMApiKey"
                            placeholder="Enter your LLM API key"
                        >
                        <small>Used for asset generation (GPT-5-Nano)</small>
                    </div>

                    <div class="form-group">
                        <label for="settingsLLMApiUrl">LLM API Endpoint</label>
                        <input
                            type="text"
                            id="settingsLLMApiUrl"
                            placeholder="https://your-llm-endpoint.com/v1/generate"
                        >
                        <small>Endpoint for LLM asset generation</small>
                    </div>

                    <div class="settings-info">
                        <p><strong>Current Status:</strong> <span id="apiKeyStatus" class="status-badge">‚úì Configured</span></p>
                        <p><small>Your API key is encrypted and stored locally</small></p>
                    </div>

                    <div id="settingsError" class="error-message" style="display: none;"></div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" id="clearApiKeyBtn" class="btn btn-danger">Clear API Key</button>
                <button type="button" id="saveSettingsBtn" class="btn btn-primary">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- Load Google Maps API -->
    <script>
        // This will be set dynamically with the API key
        let googleMapsScriptLoaded = false;
    </script>

    <!-- Main Application Script -->
    <script src="app.js"></script>
</body>
</html>
